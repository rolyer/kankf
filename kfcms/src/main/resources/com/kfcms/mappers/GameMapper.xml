<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.kfcms.dao.GameDao">

	<resultMap id="baseResultMap" type="game">
		<result property="id" column="id" />
		<result property="userName" column="user_name" />
		<result property="name" column="name" />
		<result property="startTime" column="start_time" />
		<result property="serverName" column="server_name" />
		<result property="url" column="url" />
		<result property="category" column="category" />
		<result property="giftName" column="gift_name" />
		<result property="platform" column="platform" />
		<result property="gmtCreated" column="gmt_created" />
		<result property="gmtModified" column="gmt_modified" />
	</resultMap>
	
	<select id="queryList" parameterType="map" resultMap="baseResultMap">
			SELECT id, user_name, name, start_time, server_name, url, category, gift_name, platform, gmt_created, gmt_modified
			FROM game
			WHERE 1=1
			<if test="startTime != null">
			    AND YEAR(start_time) = YEAR(#{startTime}) 
				AND DAY(start_time) = DAY(#{startTime})
				AND MONTH(start_time) = MONTH(#{startTime})
		    </if>
			ORDER BY id DESC
			LIMIT 0, #{num}
	</select>
	
	<select id="queryListByConditions" parameterType="game" resultMap="baseResultMap">
			SELECT g.id, g.user_name, g.name, g.start_time, g.server_name, g.url, g.category, g.gift_name, g.platform, g.gmt_created, g.gmt_modified
			FROM game g
			WHERE 1=1
			<if test="game != null">
				<if test="game.userName != null">
					AND g.user_name = #{game.userName}
				</if>
				<if test="game.startTime != null">
					AND YEAR(start_time) = YEAR(#{game.startTime}) 
					AND DAY(start_time) = DAY(#{game.startTime})
					AND MONTH(start_time) = MONTH(#{game.startTime})
				</if>
			</if>
			ORDER BY id DESC
			LIMIT #{offset}, #{rowCount} 
	</select>
	
	<select id="countListByConditions" parameterType="game" resultType="int">
			SELECT COUNT(g.id) FROM game g
			WHERE 1=1
			<if test="game != null">
				<if test="game.userName != null">
					AND g.user_name = #{game.userName}
				</if>
				<if test="game.startTime != null">
					AND YEAR(start_time) = YEAR(#{game.startTime}) 
					AND DAY(start_time) = DAY(#{game.startTime})
					AND MONTH(start_time) = MONTH(#{game.startTime})
				</if>
			</if>
	</select>
	
	<select id="query" parameterType="game" resultMap="baseResultMap">
			SELECT id, user_name, name, start_time, server_name, url, category, gift_name, platform, gmt_created, gmt_modified
			FROM game
			WHERE id = #{id} AND user_name = #{userName}
	</select>
	
	<insert id="insert" parameterType="game">
		INSERT INTO game
			(
			user_name,
			name,
			start_time,
			server_name,
			url,
			category,
			gift_name,
			platform,
			gmt_created,
			gmt_modified)
		VALUES
			(
			#{userName},
			#{name},
			#{startTime},
			#{serverName},
			#{url},
			#{category},
			#{giftName},
			#{platform},
			#{gmtCreated},
			#{gmtModified})
	</insert>
	
	<update id="update" parameterType="game">
		UPDATE game
		SET
		name = #{name},
		start_time = #{startTime},
		server_name = #{serverName},
		url = #{url},
		category = #{category},
		gift_name = #{giftName},
		platform = #{platform},
		gmt_modified = #{gmtModified}
		WHERE id = #{id} AND user_name = #{userName}
	</update>
	
	<delete id="delete" parameterType="game">
		DELETE FROM game
		WHERE id = #{id} AND user_name = #{userName}
	</delete>
</mapper>